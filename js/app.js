!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";var d=a("./highcharts-defaults"),e=function(a,b){return b=b||1,"https://spreadsheets.google.com/feeds/list/"+a+"/"+b+"/public/values?alt=json-in-script&callback=JSON_CALLBACK"},f=function(a,b){var c=[];return"undefined"!=typeof b&&b&&(c={}),a.forEach(function(a){var d={};for(var e in a)if(0==e.indexOf("gsx$")){var f=e.replace("gsx$","");d[f]=a[e].$t}"undefined"!=typeof b&&b?c[d[b]]=d:c.push(d)}),c};b.exports=function(a){a.controller("SiteCtrl",["$rootScope","$scope","$http",function(a,b,c){b.showNav=!1,b.toggleNav=function(){b.showNav?b.showNav=!1:b.showNav=!0},document.onkeydown=function(a){a=a||window.event,27==a.keyCode&&b.showNav&&b.$apply(function(){b.showNav=!1})},b.viewing="dashboard",b.setView=function(a){b.viewing=a},b.$watch("viewing",function(){"stories"==b.viewing?a.$broadcast("toggleStories",!0):a.$broadcast("toggleStories",!1)}),b.searchStories="",c.get("https://infoamazonia.org/es/?s=colombia&geojson=1").then(function(a){b.stories=a.data.features}),b.focusedStory=!1,b.$on("storyFocus",function(a,c){b.focusedStory=c}),b.isDifferentDate=function(a,b,c){return!a[b]||!moment(a[b].properties.date).isSame(moment(c),"day")}}]).controller("DashboardCtrl",["$scope","$http","$rootScope","$timeout",function(a,b,c,g){var h="1SJwsxzWkuBa6BwcgOWVDDODMAaeMgbrM1IQUoRB5WG4";a.dataSheet={},b.jsonp(e(h,1)).then(function(b){a.dataSheet=f(b.data.feed.entry,"departamento")}),b.jsonp(e(h,2)).then(function(b){a.dataIndex=f(b.data.feed.entry,"column")}),a.dataColumn=function(b,c){return a.matchColumns(b,c)[0]},a.matchColumns=function(b,c){var d=[];for(var e in a.dataIndex)for(var f in a.dataIndex[e])f==b&&a.dataIndex[e][f]==c&&d.push(a.dataIndex[e]);return d},a.dataUniqKeys=function(b){var c=[],d=_.values(a.dataIndex);return d.forEach(function(a){a[b]&&c.push(a[b])}),_.uniq(c)},a.showDashboardMain=function(){return!a.gridItem},a.mainChart={},a.$watch("dataSheet",function(){a.dataSheet&&(a.mainChart.ref=_.last(a.dataUniqKeys("reference")),g(function(){a.mainChart.ref=_.last(a.dataUniqKeys("reference"))},50))}),a.selectMainChartRef=function(b){a.mainChart.ref=b},a.$watch("mainChart",function(){var b=!1;a.mainChart&&(b=a.mainChart.ref);var c=[];if(b){var e=a.matchColumns("reference",b);e.forEach(function(a){c.push(a.series)}),a.mainSeries=_.uniq(c),a.mainChartConfig={},a.mainSeries.forEach(function(){a.mainChartConfig[c]||(a.mainChartConfig[c]=angular.extend({},d));var b={data:[]};for(var e in a.dataSheet){var f=[];f[0]=e;for(var g in a.dataSheet[e]){var h=a.dataColumn("column",g);if(h.reference==a.mainChart.ref){var i=parseFloat(a.dataSheet[e][g]);isNaN(i)?f[1]=null:f[1]=i}}b.data.push(f)}a.mainChartConfig[c].series=[b]})}},!0),a.chartConfig=angular.extend({},d),c.$on("mapGridItem",function(b,c){if(angular.equals(a.gridItem,c))return!1;if(a.gridItem=c,c){var d=a.dataUniqKeys("series"),e=[];d.forEach(function(b){var d={data:[]},f=a.matchColumns("series",b);f.forEach(function(a){d.data.push([a.reference,c[a.column]])}),e.push(d)}),a.chartConfig.series=e}else a.chartConfig.series=[];window.dispatchEvent(new Event("resize")),setTimeout(function(){window.dispatchEvent(new Event("resize"))},100)})}]).controller("MapCtrl",["$rootScope","$scope","$timeout","$http","LoadingService",function(a,b,c,d,e){b.timeline={items:[{title:"1990",username:"infoamazonia",sql:"select * from bnb_1990_ideamamz"},{title:"2000",username:"infoamazonia",sql:"select * from bnb_ideamz_2000_ha"},{title:"2005",username:"infoamazonia",sql:"select * from bnb_amzideam_2005_ha"},{title:"2010",username:"infoamazonia",sql:"select * from bnb_amzideam_2010_ha"},{title:"2013",username:"infoamazonia",sql:"select * from bnb_2013_amzideam_ha"}]},b.user="infoamazonia",b.dataTable="ideam_deforestacion_anual",b.geomTable="provincias_area_estudio_amz_wgs84",b.queryWhere="data.departamento = geom.nom_depto",b.sql=new cartodb.SQL({user:b.user}),b.dataQuery="SELECT * FROM "+b.dataTable,b.sql.execute(b.dataQuery).done(function(c){var d=[];for(var e in c.fields)"the_geom"!==e&&"the_geom_webmercator"!==e&&"cartodb_id"!==e&&d.push(e);a.$apply(function(){b.columns=d,b.query="SELECT geom.cartodb_id, geom.the_geom, geom.the_geom_webmercator, data."+b.columns.join(", data.")+" FROM "+b.dataTable+" as data, "+b.geomTable+" as geom WHERE "+b.queryWhere+" GROUP BY data.cartodb_id, geom.cartodb_id"})})}]).controller("AboutDataCtrl",["$scope",function(a){a.displayContent=!1,a.toggleContent=function(){a.displayContent?a.displayContent=!1:a.displayContent=!0}}])}},{"./highcharts-defaults":5}],2:[function(a,b,c){"use strict";b.exports=function(a,b){var c=L.control.layers({},{},{position:"topleft"}).addTo(a),d=[{name:"RÃ­os",zIndex:3,target:a,sublayers:[{cartocss:"css/osm_colamz_water_polygon.cartocss",user:"infoamazonia",sql:"SELECT * FROM osm_colamz_water_polygon",interactivity:null},{cartocss:"css/osm_colamz_water_lines.cartocss",user:"infoamazonia",sql:"SELECT * FROM osm_colamz_water_lines",interactivity:null}]},{name:"Areas Protegidas",zIndex:7,sublayers:[{cartocss:"css/protected_areas.cartocss",user:"infoamazonia",sql:"select * from anp_nacional where nacionales_pais= 'Colombia'",interactivity:"nacionales_nombre"}]},{name:"Territorios Indigenas",zIndex:7,sublayers:[{cartocss:"css/territ_indig.cartocss",user:"infoamazonia",sql:"select * from territ_rios_ind_genas where tis_pais='Colombia'",interactivity:"tis_nombre"},{cartocss:"css/aislados_referencia_.cartocss",user:"infoamazonia",sql:"SELECT * FROM aislados_referencia_ WHERE pais='Colombia'",interactivity:"nombre"}]},{name:"Carreteras",zIndex:7,sublayers:[{cartocss:"css/roads.cartocss",user:"infoamazonia",sql:"select * from carreteras where pais='Colombia'",interactivity:null}]}];d.forEach(function(a){var d=L.layerGroup({zIndex:a.zIndex}),e=a.target||c;e.addOverlay?e.addOverlay(d,a.name):e.addLayer(d),a.sublayers.forEach(function(c){b.get(c.cartocss).then(function(b){var e=b.data,f={user_name:c.user,sublayers:[{sql:c.sql,cartocss:e,interactivity:c.interactivity}]};cartodb.Tiles.getTiles(f,function(b,c){if(null==b)console.log("error: ",c.errors.join("\n"));else{var e=L.tileLayer(b.tiles[0],{zIndex:a.zIndex});d.addLayer(e);var f=new L.UtfGrid(b.grids[0][0]+"&callback={cb}");d.addLayer(f),f.on("mouseover",function(a){}),f.on("mouseout",function(a){})}})})})})}},{}],3:[function(a,b,c){"use strict";function d(a,b){var c=["#layer { polygon-fill: transparent; polygon-opacity: 1; line-width: 1; line-opacity: 0.5; line-color: #fff; }","#layer[zoom>=8] { line-width: 2; }","#layer[zoom>=10] { line-width: 3; }","#layer::labels[zoom>=7] {","text-name: [departamento];",'text-face-name: "Open Sans Italic";',"text-size: 12;","text-fill: #FFFFFF;","text-label-position-tolerance: 0;","text-transform: uppercase;","text-halo-radius: 0;","text-dy: -10;","text-allow-overlap: false;","text-placement: interior;","text-placement-type: simple;","[zoom=8]{text-size: 15;}","[zoom=9]{text-size: 17;}","[zoom>=10]{text-size: 19;}","}"];return c.join(" ")}function e(a,b,c,d){a.execute("SELECT CDB_HeadsTailsBins(array_agg(cast("+c+" as numeric)), 7) FROM "+b).done(function(a){var b=a.rows[0].cdb_headstailsbins;d(b)})}b.exports=function(b){b.directive("backImg",function(){return function(a,b,c){var d=c.backImg;b.css({"background-image":"url("+d+")"})}}),b.directive("story",[function(){return{restrict:"EA",scope:{story:"=",focused:"=focusedStory"},link:function(a,b,c){a.$watch("focused",function(){a.story.properties.id==a.focused&&($("#sidebar").animate({scrollTop:$(b).position().top-50},200),setTimeout(function(){$(b).removeClass("focused-story")},1500))})}}}]),b.directive("mapTimeline",["$q","$interval","$timeout","$rootScope","$http","Globals",function(a,b,c,d,e,f){return{restrict:"E",scope:{items:"="},templateUrl:"views/timeline.html",link:function(d,g,h){d.layerGroup=!1,d.$watch(function(){return f.get("timelineLayerGroup")},function(a){d.layerGroup=a}),e.get("css/bnb.cartocss").then(function(e){var f=e.data;d.$watchGroup(["layerGroup","items"],function(){if(d.items&&d.layerGroup){var b=[];d.items.forEach(function(a,c){b.push(j(a,c+1))}),a.all(b).then(function(a){d.layers=a,d.layers.forEach(function(a){d.layerGroup.addLayer(a)}),d.displayLayer(d.items[0]),c(function(){d.toggleAuto()},2e3)})}});var g;d.toggleAuto=function(){angular.isDefined(g)?d.stopAuto():(d.auto=!0,g=b(function(){d.activeItem._played=!0;var a=h(d.activeItem,d.items),b=a+1;b==d.items.length&&(d.items.forEach(function(a){a._played=!1}),b=0),c(function(){d.displayLayer(d.items[b])},5)},2e3))},d.stopAuto=function(){angular.isDefined(g)&&(d.auto=!1,b.cancel(g),g=void 0)};var h=function(a,b){var c=-1;return b.forEach(function(b,d){b.title==a.title&&(c=d)}),c},i=!1;d.displayLayer=function(a){if(!i){i=!0,d.activeItem=a;var b=_.find(d.layers,function(b){return b._item.title==a.title});angular.element(b.getContainer());d.layers.forEach(function(a){var c=angular.element(a.getContainer());b._leaflet_id!==a._leaflet_id&&(c.removeClass("active"),setTimeout(function(){a.setOpacity(0),i=!1},350))}),angular.element(b.getContainer()).addClass("active"),b.setOpacity(1)}};var j=function(b,c){var d=a.defer();return cartodb.Tiles.getTiles({user_name:b.username,sublayers:[{sql:b.sql,cartocss:f}]},function(a,e){if(null==a)d.reject(e);else{var f=L.tileLayer(a.tiles[0],{zIndexOffset:c});f._item=b,d.resolve(f)}}),d.promise}})}}}]),b.directive("map",["$rootScope","$timeout","$http","LoadingService","Globals",function(b,c,f,g,h){return{restrict:"EAC",scope:{username:"=",sql:"=",query:"=",columns:"=",table:"=",gridItem:"=",geojson:"="},link:function(c,i,j){function k(a){var d={user_name:c.username,sublayers:[{sql:c.query,cartocss:a,interactivity:c.columns}]};cartodb.Tiles.getTiles(d,function(a,d){if(null==a)console.log("error: ",d.errors.join("\n"));else{r=L.tileLayer(a.tiles[0],{zIndex:10}),p.addLayer(r),c.sql.getBounds(c.query).done(function(a){l.fitBounds(a,{paddingTopLeft:[0,0],paddingBottomRight:[.4*window.innerWidth,0]})}),s=new L.UtfGrid(a.grids[0][0]+"&callback={cb}"),p.addLayer(s);var e=!1;s.on("click",function(a){e=!0,c.$apply(function(){b.$broadcast("mapGridItem",a.data)})});var f;s.on("mousemove",function(a){clearTimeout(f),e||c.$apply(function(){b.$broadcast("mapGridItem",a.data)})}),s.on("mouseout",function(a){e||(f=setTimeout(function(){c.$apply(function(){b.$broadcast("mapGridItem",!1)})},200))})}})}var l=L.map(i[0],{center:[0,0],zoom:1,scrollWheelZoom:!0,fadeAnimation:!1}),m={base:{title:"Base layer",layer:L.tileLayer("https://api.mapbox.com/styles/v1/infoamazonia/cirgitmlm0010gdm9cd48fmlz/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiaW5mb2FtYXpvbmlhIiwiYSI6InItajRmMGsifQ.JnRnLDiUXSEpgn7bPDzp7g",{zIndex:1})},labels:{title:"Labels",layer:L.tileLayer("https://api.mapbox.com/styles/v1/infoamazonia/ciuu34i5l005h2inn3843b6b3/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiaW5mb2FtYXpvbmlhIiwiYSI6InItajRmMGsifQ.JnRnLDiUXSEpgn7bPDzp7g",{zIndex:6})}};for(var n in m)l.addLayer(m[n].layer);a("./custom-layers")(l,f);var o=L.layerGroup({zIndex:2}),p=L.layerGroup({zIndex:10}),q=L.layerGroup({zIndex:5});b.$on("toggleStories",function(a,b){b?l.addLayer(q):l.removeLayer(q)}),h.set("timelineLayerGroup",o),setTimeout(function(){o.addTo(l),p.addTo(l)},2e3);var r,s,t;c.$watchGroup(["username","query","sql","columns","dataTable"],function(){"undefined"!=typeof r&&p.removeLayer(r),"undefined"!=typeof s&&p.removeLayer(s),c.username&&c.query&&c.sql&&c.columns&&(c.column=c.columns[2],e(c.sql,c.table,c.column,function(a){var b=d(c.column,a);k(b)}))});var u=(L.icon({iconUrl:"img/marker.png",iconSize:[16,20],iconAnchor:[8,20],popupAnchor:[0,-25]}),L.icon({iconUrl:"img/marker_.png",iconSize:[12,16],iconAnchor:[6,16],popupAnchor:[0,-20]})),v=!1,w=_.debounce(function(){"undefined"!=typeof t&&q.removeLayer(t),c.geojson&&c.geojson.length&&(t=L.geoJSON(c.geojson,{pointToLayer:function(a,b){var c=L.marker(b,{icon:u,bounceOnAdd:!0,bounceOnAddOptions:{duration:500,height:100}});return c},onEachFeature:function(a,c){a.properties&&(c.bindPopup("<h2>"+a.properties.title+"</h2>"),c.on("mouseover",function(a){a.target.openPopup(),a.target.setZIndexOffset(10)}),c.on("mouseout",function(a){a.target.closePopup(),a.target.setZIndexOffset(0)}),c.on("click",function(a){b.$broadcast("storyFocus",a.target.feature.properties.id)}))}}),q.addLayer(t)),g.remove(v),v=!1},800);c.$watch("geojson",function(){v||(v=g.add("Loading stories"),w())})}}}])}},{"./custom-layers":2}],4:[function(a,b,c){"use strict";b.exports=function(a){a.filter("formatDate",[function(){return function(a,b){return a&&(a=moment(a).format(b||"LLLL")),a}}]),a.filter("memoize",[function(){return _.memoize(function(a){return a},function(){return JSON.stringify(arguments)})}]),a.filter("validate",[function(){return function(a,b){var c,d=!0;switch(b){case"number":c=isNaN,d=!1}return a&&a.length&&(a=a.filter(function(a){return d?c(a):!c(a)})),a}}])}},{}],5:[function(a,b,c){b.exports={options:{chart:{type:"bar",animation:!1,backgroundColor:null,plotBackgroundColor:null,style:{fontFamily:"Open Sans",color:"#ffffff"}},tooltip:{enabled:!1,style:{padding:10,fontWeight:"bold"}},title:!1,subtitle:!1,legend:{enabled:!1},plotOptions:{series:{animation:!1,color:"#FF9966",borderWidth:0,dataLabels:{format:"{y} ha",enabled:!0,color:"#ffffff"},marker:{symbol:"circle"}}},yAxis:{labels:{style:{color:"#fff"}},gridLineColor:"rgba(255,255,255,0.1)",visible:!1},xAxis:{type:"category",labels:{format:"{value}",style:{color:"#fff"}},gridLineColor:"rgba(255,255,255,0.2)",visible:!0,tickLength:0},credits:{enabled:!1}}}},{}],6:[function(a,b,c){var d=angular.module("ia-colombia",["ngAnimate","highcharts-ng"]);a("./services")(d),a("./directives")(d),a("./filters")(d),a("./controllers")(d),a("./loading")(d),angular.element(document).ready(function(){angular.bootstrap(document,["ia-colombia"])})},{"./controllers":1,"./directives":3,"./filters":4,"./loading":7,"./services":8}],7:[function(a,b,c){"use strict";b.exports=function(a){a.run(["$rootScope","LoadingService",function(a,b){"undefined"!=typeof jQuery&&(jQuery(document).ajaxSend(function(a,c,d){d.loadingMsg!==!1&&(d.loadingId=b.add(d.loadingMessage))}),jQuery(document).ajaxComplete(function(c,d,e){e.loadingMsg!==!1&&a.$apply(function(){b.remove(e.loadingId)})}),jQuery(document).ajaxError(function(c,d,e){e.loadingMsg!==!1&&a.$apply(function(){b.remove(e.loadingId)})}),jQuery(document).ajaxSuccess(function(c,d,e){e.loadingMsg!==!1&&a.$apply(function(){b.remove(e.loadingId)})}))}]).config(["$httpProvider",function(a){a.interceptors.push("loadingStatusInterceptor")}]).service("LoadingService",[function(){var a=[];return{get:function(){return a},add:function(b,c){"undefined"==typeof c&&(c=Math.random());var d={_id:c,msg:b};return a.push(d),a=a,d._id},remove:function(b){return a=a.filter(function(a){return a._id!==b}),a=a}}}]).directive("loadingStatusMessage",["$timeout","LoadingService",function(a,b){return{template:'<div class="loading-message"><span class="fa fa-circle-o-notch fa-spin fa-3x fa-fw"></span><span ng-repeat="load in loads" ng-show="load.msg">{{load.msg}}<br/></span></div>',link:function(a,c,d){a.$watch(function(){return b.get()},function(b){a.loads=b})}}}]).factory("loadingStatusInterceptor",["$q","$rootScope","$timeout","LoadingService",function(a,b,c,d){return{request:function(b){return b.loadingMessage&&(b.loadingId=d.add(b.loadingMessage)),b||a.when(b)},response:function(b){return b.config.loadingId&&d.remove(b.config.loadingId),b||a.when(b)},responseError:function(b){return b.config.loadingId&&d.remove(b.config.loadingId),a.reject(b)}}}])}},{}],8:[function(a,b,c){"use strict";b.exports=function(a){a.factory("Globals",[function(){var a={};return{set:function(b,c){a[b]=c},get:function(b){return a[b]}}}])}},{}]},{},[6]);