!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";var d=a("./highcharts-defaults"),e=function(a){var b={};return a.forEach(function(a){var c={};for(var d in a)if(0==d.indexOf("gsx$")){var e=d.replace("gsx$","");c[e]=a[d].$t}b[c.column]=c}),b};b.exports=function(a){a.controller("SiteCtrl",["$rootScope","$scope",function(a,b){b.showNav=!1,b.toggleNav=function(){b.showNav?b.showNav=!1:b.showNav=!0},b.viewing="dashboard",b.setView=function(a){b.viewing=a},b.$watch("viewing",function(){"stories"==b.viewing?a.$broadcast("toggleStories",!0):a.$broadcast("toggleStories",!1)}),b.isDifferentDate=function(a,b,c){return!a[b]||!moment(a[b].properties.date).isSame(moment(c),"day")}}]).controller("DashboardCtrl",["$scope","$http",function(a,b){var c="1SJwsxzWkuBa6BwcgOWVDDODMAaeMgbrM1IQUoRB5WG4",d="https://spreadsheets.google.com/feeds/list/"+c+"/2/public/values?alt=json-in-script&callback=JSON_CALLBACK";b.jsonp(d).then(function(b){a.dataIndex=e(b.data.feed.entry)}),a.dataColumn=function(b,c){return a.matchColumns(b,c)[0]},a.matchColumns=function(b,c){var d=[];for(var e in a.dataIndex)for(var f in a.dataIndex[e])f==b&&a.dataIndex[e][f]==c&&d.push(a.dataIndex[e]);return d},a.dataUniqKeys=function(b){var c=[],d=_.values(a.dataIndex);return d.forEach(function(a){a[b]&&c.push(a[b])}),_.uniq(c)}}]).controller("MapCtrl",["$rootScope","$scope","$timeout","$http","LoadingService",function(a,b,c,e,f){b.timeline={items:[{title:"1990",username:"infoamazonia",sql:"select * from bnb_1990_ideamamz"},{title:"2000",username:"infoamazonia",sql:"select * from bnb_ideamz_2000_ha"},{title:"2005",username:"infoamazonia",sql:"select * from bnb_amzideam_2005_ha"},{title:"2010",username:"infoamazonia",sql:"select * from bnb_amzideam_2010_ha"},{title:"2013",username:"infoamazonia",sql:"select * from bnb_2013_amzideam_ha"}]},b.user="infoamazonia",b.dataTable="ideam_deforestacion_anual",b.geomTable="depto_amzideam",b.queryWhere="data.departamento = geom.nom_depto",b.sql=new cartodb.SQL({user:b.user}),b.dataQuery="SELECT * FROM "+b.dataTable,b.gridItem=!1,b.sql.execute(b.dataQuery).done(function(c){var d=[];for(var e in c.fields)"the_geom"!==e&&"the_geom_webmercator"!==e&&"cartodb_id"!==e&&d.push(e);a.$apply(function(){b.columns=d,b.query="SELECT geom.cartodb_id, geom.the_geom, geom.the_geom_webmercator, data."+b.columns.join(", data.")+" FROM "+b.dataTable+" as data, "+b.geomTable+" as geom WHERE "+b.queryWhere+" GROUP BY data.cartodb_id, geom.cartodb_id"})}),b.$watch("gridItem",function(){b.chartConfig=angular.extend({series:[{data:[b.gridItem.deforestacion_2014,b.gridItem.deforestacion_2015]}]},d)}),b.searchStories="",e.get("https://infoamazonia.org/es/?s=colombia&geojson=1").then(function(a){b.stories=a.data.features}),b.focusedStory=!1,b.$on("storyFocus",function(a,c){b.focusedStory=c})}])}},{"./highcharts-defaults":4}],2:[function(a,b,c){"use strict";function d(a,b){var c=["#layer { polygon-fill: transparent; polygon-opacity: 1; line-width: 1; line-opacity: 0.5; line-color: #fff; }"];return c.join(" ")}function e(a,b,c,d){a.execute("SELECT CDB_HeadsTailsBins(array_agg(cast("+c+" as numeric)), 7) FROM "+b).done(function(a){var b=a.rows[0].cdb_headstailsbins;d(b)})}b.exports=function(a){a.directive("backImg",function(){return function(a,b,c){var d=c.backImg;b.css({"background-image":"url("+d+")"})}}),a.directive("story",[function(){return{restrict:"EA",scope:{story:"=",focused:"=focusedStory"},link:function(a,b,c){a.$watch("focused",function(){a.story.properties.id==a.focused&&($("#sidebar").animate({scrollTop:$(b).position().top-50},200),setTimeout(function(){$(b).removeClass("focused-story")},1500))})}}}]),a.directive("mapTimeline",["$q","$interval","$timeout","$rootScope","$http","Globals",function(a,b,c,d,e,f){return{restrict:"E",scope:{items:"="},templateUrl:"views/timeline.html",link:function(d,g,h){d.layerGroup=!1,d.$watch(function(){return f.get("timelineLayerGroup")},function(a){d.layerGroup=a}),e.get("css/bnb.cartocss").then(function(e){var f=e.data;d.$watchGroup(["layerGroup","items"],function(){if(d.items&&d.layerGroup){var b=[];d.items.forEach(function(a,c){b.push(j(a,c+1))}),a.all(b).then(function(a){d.layers=a,d.layers.forEach(function(a){d.layerGroup.addLayer(a)}),d.displayLayer(d.items[0]),c(function(){d.toggleAuto()},2e3)})}});var g;d.toggleAuto=function(){angular.isDefined(g)?d.stopAuto():(d.auto=!0,g=b(function(){d.activeItem._played=!0;var a=h(d.activeItem,d.items),b=a+1;b==d.items.length&&(d.items.forEach(function(a){a._played=!1}),b=0),c(function(){d.displayLayer(d.items[b])},5)},2e3))},d.stopAuto=function(){angular.isDefined(g)&&(d.auto=!1,b.cancel(g),g=void 0)};var h=function(a,b){var c=-1;return b.forEach(function(b,d){b.title==a.title&&(c=d)}),c},i=!1;d.displayLayer=function(a){if(!i){i=!0,d.activeItem=a;var b=_.find(d.layers,function(b){return b._item.title==a.title});angular.element(b.getContainer());d.layers.forEach(function(a){var c=angular.element(a.getContainer());b._leaflet_id!==a._leaflet_id&&(c.removeClass("active"),setTimeout(function(){a.setOpacity(0),i=!1},350))}),angular.element(b.getContainer()).addClass("active"),b.setOpacity(1)}};var j=function(b,c){var d=a.defer();return cartodb.Tiles.getTiles({user_name:b.username,sublayers:[{sql:b.sql,cartocss:f}]},function(a,e){if(null==a)d.reject(e);else{var f=L.tileLayer(a.tiles[0],{zIndexOffset:c});f._item=b,d.resolve(f)}}),d.promise}})}}}]),a.directive("map",["$rootScope","$timeout","$http","LoadingService","Globals",function(a,b,c,f,g){return{restrict:"EAC",scope:{username:"=",sql:"=",query:"=",columns:"=",table:"=",gridItem:"=",geojson:"="},link:function(b,c,h){function i(a){var c={user_name:b.username,sublayers:[{sql:b.query,cartocss:a,interactivity:b.columns}]};cartodb.Tiles.getTiles(c,function(a,c){null==a?console.log("error: ",c.errors.join("\n")):(n=L.tileLayer(a.tiles[0]),l.addLayer(n),b.sql.getBounds(b.query).done(function(a){j.fitBounds(a,{paddingTopLeft:[0,0],paddingBottomRight:[.4*window.innerWidth,0]})}),o=new L.UtfGrid(a.grids[0][0]+"&callback={cb}"),l.addLayer(o),o.on("mouseover",function(a){b.$apply(function(){b.gridItem=a.data})}),o.on("mouseout",function(a){b.$apply(function(){b.gridItem=!1})}))})}var j=L.map(c[0],{center:[0,0],zoom:1,scrollWheelZoom:!0,fadeAnimation:!1});j.addLayer(L.tileLayer("https://api.mapbox.com/styles/v1/infoamazonia/cirgitmlm0010gdm9cd48fmlz/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiaW5mb2FtYXpvbmlhIiwiYSI6InItajRmMGsifQ.JnRnLDiUXSEpgn7bPDzp7g",{zIndex:1})),j.addLayer(L.tileLayer("https://api.mapbox.com/styles/v1/infoamazonia/ciuu7vi3k00dj2js5rt68bm9t/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiaW5mb2FtYXpvbmlhIiwiYSI6InItajRmMGsifQ.JnRnLDiUXSEpgn7bPDzp7g",{zIndex:3}));var k=L.layerGroup({zIndex:2}),l=L.layerGroup({zIndex:4}),m=L.layerGroup({zIndex:5});a.$on("toggleStories",function(a,b){b?j.addLayer(m):j.removeLayer(m)}),g.set("timelineLayerGroup",k),setTimeout(function(){k.addTo(j),l.addTo(j)},2e3);var n,o,p;b.$watchGroup(["username","query","sql","columns","dataTable"],function(){"undefined"!=typeof n&&l.removeLayer(n),"undefined"!=typeof o&&l.removeLayer(o),b.username&&b.query&&b.sql&&b.columns&&(b.column=b.columns[2],e(b.sql,b.table,b.column,function(a){var c=d(b.column,a);i(c)}))});var q=(L.icon({iconUrl:"img/marker.png",iconSize:[16,20],iconAnchor:[8,20],popupAnchor:[0,-25]}),L.icon({iconUrl:"img/marker_.png",iconSize:[12,16],iconAnchor:[6,16],popupAnchor:[0,-20]})),r=!1,s=_.debounce(function(){"undefined"!=typeof p&&m.removeLayer(p),b.geojson&&b.geojson.length&&(p=L.geoJSON(b.geojson,{pointToLayer:function(a,b){var c=L.marker(b,{icon:q,bounceOnAdd:!0,bounceOnAddOptions:{duration:500,height:100}});return c},onEachFeature:function(b,c){b.properties&&(c.bindPopup("<h2>"+b.properties.title+"</h2>"),c.on("mouseover",function(a){a.target.openPopup(),a.target.setZIndexOffset(10)}),c.on("mouseout",function(a){a.target.closePopup(),a.target.setZIndexOffset(0)}),c.on("click",function(b){a.$broadcast("storyFocus",b.target.feature.properties.id)}))}}),m.addLayer(p)),f.remove(r),r=!1},800);b.$watch("geojson",function(){r||(r=f.add("Loading stories"),s())})}}}])}},{}],3:[function(a,b,c){"use strict";b.exports=function(a){a.filter("formatDate",[function(){return function(a,b){return a&&(a=moment(a).format(b||"LLLL")),a}}]),a.filter("memoize",[function(){return _.memoize(function(a){return a},function(){return JSON.stringify(arguments)})}])}},{}],4:[function(a,b,c){b.exports={options:{chart:{type:"spline",backgroundColor:null,plotBackgroundColor:null,style:{fontFamily:"Open Sans",color:"#ffffff"}},tooltip:{style:{padding:10,fontWeight:"bold"}},title:!1,subtitle:!1,legend:{enabled:!1},plotOptions:{series:{color:"#f26969"}},yAxis:{labels:{style:{color:"#fff"}},gridLineColor:"rgba(255,255,255,0.1)"},xAxis:{labels:{style:{color:"#fff"}}},credits:{enabled:!1}}}},{}],5:[function(a,b,c){var d=angular.module("ia-colombia",["ngAnimate","highcharts-ng"]);a("./services")(d),a("./directives")(d),a("./filters")(d),a("./controllers")(d),a("./loading")(d),angular.element(document).ready(function(){angular.bootstrap(document,["ia-colombia"])})},{"./controllers":1,"./directives":2,"./filters":3,"./loading":6,"./services":7}],6:[function(a,b,c){"use strict";b.exports=function(a){a.run(["$rootScope","LoadingService",function(a,b){"undefined"!=typeof jQuery&&(jQuery(document).ajaxSend(function(a,c,d){d.loadingMsg!==!1&&(d.loadingId=b.add(d.loadingMessage))}),jQuery(document).ajaxComplete(function(c,d,e){e.loadingMsg!==!1&&a.$apply(function(){b.remove(e.loadingId)})}),jQuery(document).ajaxError(function(c,d,e){e.loadingMsg!==!1&&a.$apply(function(){b.remove(e.loadingId)})}),jQuery(document).ajaxSuccess(function(c,d,e){e.loadingMsg!==!1&&a.$apply(function(){b.remove(e.loadingId)})}))}]).config(["$httpProvider",function(a){a.interceptors.push("loadingStatusInterceptor")}]).service("LoadingService",[function(){var a=[];return{get:function(){return a},add:function(b,c){"undefined"==typeof c&&(c=Math.random());var d={_id:c,msg:b};return a.push(d),a=a,d._id},remove:function(b){return a=a.filter(function(a){return a._id!==b}),a=a}}}]).directive("loadingStatusMessage",["$timeout","LoadingService",function(a,b){return{template:'<div class="loading-message"><span class="fa fa-circle-o-notch fa-spin fa-3x fa-fw"></span><span ng-repeat="load in loads" ng-show="load.msg">{{load.msg}}<br/></span></div>',link:function(a,c,d){a.$watch(function(){return b.get()},function(b){a.loads=b})}}}]).factory("loadingStatusInterceptor",["$q","$rootScope","$timeout","LoadingService",function(a,b,c,d){return{request:function(b){return b.loadingMessage&&(b.loadingId=d.add(b.loadingMessage)),b||a.when(b)},response:function(b){return b.config.loadingId&&d.remove(b.config.loadingId),b||a.when(b)},responseError:function(b){return b.config.loadingId&&d.remove(b.config.loadingId),a.reject(b)}}}])}},{}],7:[function(a,b,c){"use strict";b.exports=function(a){a.factory("Globals",[function(){var a={};return{set:function(b,c){a[b]=c},get:function(b){return a[b]}}}])}},{}]},{},[5]);